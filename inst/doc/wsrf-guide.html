<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="He Zhao, Graham Williams" />

<meta name="date" content="2015-07-07" />

<title>A Quick Start Guide for wsrf</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link href="data:text/css;charset=utf-8,body%7Bbackground%2Dcolor%3A%23fff%3Bmargin%3A1emauto%3Bmax%2Dwidth%3A800px%3Boverflow%3Avisible%3Bpadding%2Dleft%3A2em%3Bpadding%2Dright%3A2em%3Bfont%2Dfamily%3A%22HelveticaNeue%22%2CHelvetica%2CArial%2Csans%2Dserif%3Bfont%2Dsize%3A14px%3Bline%2Dheight%3A20px%3B%7D%23header%7Btext%2Dalign%3Acenter%3B%7D%23TOC%7Bclear%3Aboth%3Bmargin%3A0010px0%3Bpadding%3A4px%3Bborder%3A1pxsolid%23CCCCCC%3Bborder%2Dradius%3A5px%3Bbackground%2Dcolor%3A%23f6f6f6%3Bfont%2Dsize%3A13px%3Bline%2Dheight%3A1%2E3%3B%7D%23TOC%2Etoctitle%7Bfont%2Dweight%3Abold%3Bfont%2Dsize%3A15px%3Bmargin%2Dleft%3A5px%3B%7D%23TOCul%7Bpadding%2Dleft%3A40px%3Bmargin%2Dleft%3A%2D1%2E5em%3Bmargin%2Dtop%3A5px%3Bmargin%2Dbottom%3A5px%3B%7D%23TOCulul%7Bmargin%2Dleft%3A%2D2em%3B%7D%23TOCli%7Bline%2Dheight%3A16px%3B%7Dtable%7Bmargin%3Aauto%3Bmin%2Dwidth%3A40%25%3Bborder%2Dwidth%3A1px%3Bborder%2Dcolor%3A%23DDDDDD%3Bborder%2Dstyle%3Aoutset%3Bborder%2Dcollapse%3Acollapse%3B%7Dtable%5Bsummary%3D%22Rargblock%22%5D%7Bwidth%3A100%25%3Bborder%3Anone%3B%7Dtableth%7Bborder%2Dwidth%3A2px%3Bpadding%3A5px%3Bborder%2Dstyle%3Ainset%3B%7Dtabletd%7Bborder%2Dwidth%3A1px%3Bborder%2Dstyle%3Ainset%3Bline%2Dheight%3A18px%3Bpadding%3A5px5px%3B%7Dtable%2Ctableth%2Ctabletd%7Bborder%2Dleft%2Dstyle%3Anone%3Bborder%2Dright%2Dstyle%3Anone%3B%7Dtabletr%2Eodd%7Bbackground%2Dcolor%3A%23f7f7f7%3B%7Dp%7Bmargin%3A0%2E5em0%3B%7Dblockquote%7Bbackground%2Dcolor%3A%23f6f6f6%3Bpadding%3A13px%3Bpadding%2Dbottom%3A1px%3B%7Dhr%7Bborder%2Dstyle%3Asolid%3Bborder%3Anone%3Bborder%2Dtop%3A1pxsolid%23777%3Bmargin%3A28px0%3B%7Ddl%7Bmargin%2Dleft%3A0%3B%7Ddldd%7Bmargin%2Dbottom%3A13px%3Bmargin%2Dleft%3A13px%3B%7Ddldt%7Bfont%2Dweight%3Abold%3B%7Dul%7Bmargin%2Dtop%3A0%3B%7Dulli%7Blist%2Dstyle%3Acircleoutside%3B%7Dulul%7Bmargin%2Dbottom%3A0%3B%7Dpre%2Ccode%7Bbackground%2Dcolor%3A%23f5f5f5%3Bborder%2Dradius%3A3px%3Bcolor%3A%23333%3B%7Dpre%7Boverflow%2Dx%3Aauto%3Bborder%2Dradius%3A3px%3Bmargin%3A5px0px10px0px%3Bpadding%3A10px%3B%7Dpre%3Anot%28%5Bclass%5D%29%7Bbackground%2Dcolor%3Awhite%3Bborder%3A%23f5f5f51pxsolid%3B%7Dpre%3Anot%28%5Bclass%5D%29code%7Bcolor%3A%23444%3Bbackground%2Dcolor%3Awhite%3B%7Dcode%7Bfont%2Dfamily%3Amonospace%3Bfont%2Dsize%3A90%25%3B%7Dp%3Ecode%2Cli%3Ecode%7Bpadding%3A2px4px%3Bcolor%3A%23d14%3Bborder%3A1pxsolid%23e1e1e8%3Bwhite%2Dspace%3Ainherit%3B%7Ddiv%2Efigure%7Btext%2Dalign%3Acenter%3B%7Dtable%3Ecaption%2Cdiv%2Efigurep%2Ecaption%7Bfont%2Dstyle%3Aitalic%3B%7Dtable%3Ecaptionspan%2Cdiv%2Efigurep%2Ecaptionspan%7Bfont%2Dstyle%3Anormal%3Bfont%2Dweight%3Abold%3B%7Dp%7Bmargin%3A0010px%3B%7Dtable%7Bmargin%3Aautoauto10pxauto%3B%7Dimg%7Bbackground%2Dcolor%3A%23FFFFFF%3Bpadding%3A2px%3Bborder%3A1pxsolid%23DDDDDD%3Bborder%2Dradius%3A3px%3Bborder%3A1pxsolid%23CCCCCC%3Bmargin%3A05px%3Bmax%2Dwidth%3A100%25%3B%7Dh1%7Bmargin%2Dtop%3A0%3Bfont%2Dsize%3A35px%3Bline%2Dheight%3A40px%3B%7Dh2%7Bborder%2Dbottom%3A4pxsolid%23f5f5f5%3Bpadding%2Dtop%3A10px%3Bpadding%2Dbottom%3A2px%3Bfont%2Dsize%3A145%25%3B%7Dh3%7Bborder%2Dbottom%3A2pxsolid%23f5f5f5%3Bpadding%2Dtop%3A10px%3Bfont%2Dsize%3A120%25%3B%7Dh4%7Bborder%2Dbottom%3A1pxsolid%23f5f5f5%3Bmargin%2Dleft%3A8px%3Bfont%2Dsize%3A105%25%3B%7Dh5%2Ch6%7Bborder%2Dbottom%3A1pxsolid%23ccc%3Bfont%2Dsize%3A105%25%3B%7Da%7Bcolor%3A%230033dd%3Btext%2Ddecoration%3Anone%3B%7Da%3Ahover%7Bcolor%3A%236666ff%3B%7Da%3Avisited%7Bcolor%3A%23800080%3B%7Da%3Avisited%3Ahover%7Bcolor%3A%23BB00BB%3B%7Da%5Bhref%5E%3D%22http%3A%22%5D%7Btext%2Ddecoration%3Aunderline%3B%7Da%5Bhref%5E%3D%22https%3A%22%5D%7Btext%2Ddecoration%3Aunderline%3B%7Ddiv%2Er%2Dhelp%2Dpage%7Bbackground%2Dcolor%3A%23f9f9f9%3Bborder%2Dbottom%3A%23ddd1pxsolid%3Bmargin%2Dbottom%3A10px%3Bpadding%3A10px%3B%7Ddiv%2Er%2Dhelp%2Dpage%3Ahover%7Bbackground%2Dcolor%3A%23f4f4f4%3B%7Dcode%3Espan%2Ekw%7Bcolor%3A%23555%3Bfont%2Dweight%3Abold%3B%7Dcode%3Espan%2Edt%7Bcolor%3A%23902000%3B%7Dcode%3Espan%2Edv%7Bcolor%3A%2340a070%3B%7Dcode%3Espan%2Ebn%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Efl%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Ech%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Est%7Bcolor%3A%23d14%3B%7Dcode%3Espan%2Eco%7Bcolor%3A%23888888%3Bfont%2Dstyle%3Aitalic%3B%7Dcode%3Espan%2Eot%7Bcolor%3A%23007020%3B%7Dcode%3Espan%2Eal%7Bcolor%3A%23ff0000%3Bfont%2Dweight%3Abold%3B%7Dcode%3Espan%2Efu%7Bcolor%3A%23900%3Bfont%2Dweight%3Abold%3B%7Dcode%3Espan%2Eer%7Bcolor%3A%23a61717%3Bbackground%2Dcolor%3A%23e3d2d2%3B%7D" rel="stylesheet" type="text/css" />

</head>

<body>



<div id="header">
<h1 class="title">A Quick Start Guide for wsrf</h1>
<h4 class="author"><em>He Zhao, Graham Williams</em></h4>
<h4 class="date"><em>2015-07-07</em></h4>
</div>

<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#requirements-and-installation-notes">Requirements and Installation Notes</a></li>
<li><a href="#usage">Usage</a></li>
</ul>
</div>

<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>The <a href="http://cran.r-project.org/package=wsrf"><strong>wsrf</strong></a> package is a parallel implementation of the Weighted Subspace Random Forest algorithm (wsrf) of <span class="citation">Xu et al. (2012)</span>. A novel variable weighting method is used for variable subspace selection in place of the traditional approach of random variable sampling. This new approach is particularly useful in building models for high dimensional data — often consisting of thousands of variables. Parallel computation is used to take advantage of multi-core machines and clusters of machines to build random forest models from high dimensional data with reduced elapsed times.</p>
</div>
<div id="requirements-and-installation-notes" class="section level2">
<h2>Requirements and Installation Notes</h2>
<p>Currently, <strong>wsrf</strong> requires R (&gt;= 3.0.0), <a href="http://cran.r-project.org/package=Rcpp"><strong>Rcpp</strong></a> (&gt;= 0.10.2) <span class="citation">(Eddelbuettel and François 2011; Eddelbuettel 2013)</span>. For the use of multi-threading, a C++ compiler with <a href="https://en.wikipedia.org/wiki/C%2B%2B11">C++11</a> standard support of threads or the <a href="http://www.boost.org/"><em>Boost</em></a> C++ library with version above 1.54 is required. The choice is available at installation time depending on what is available to the user. To install the latest version of the package, from within R run:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;wsrf&quot;</span>)</code></pre></div>
<p>By default, multi-threading functionality is not enabled, which can be configured through the argument <code>configure.args=</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;wsrf&quot;</span>,
                 <span class="dt">type=</span><span class="st">&quot;source&quot;</span>,
                 <span class="dt">configure.args=</span><span class="st">&quot;--enable-c11=yes&quot;</span>)</code></pre></div>
<p>We recommend using C++11 standard library for accessing multi-threaded functionality, which will be our main focus for development in the future. Though support for compiling C++11 code in packages is not fully supported in current release of R, it has been tested that it can be compiled if the user has already installed the latest version of <a href="https://gcc.gnu.org/"><em>GCC</em></a> and C++ standard library<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
<p>Besides the default installation for C++11, we also provide another implementations of <strong>wsrf</strong>, which implements parallelism using <em>Boost</em>.</p>
<p>The choice of version to install is available at installation. The version without parallelism, as required when C++11 is not available nor is <em>Boost</em>, and is the recommended and only possible choice for Microsoft Windows platform with the current version of R (3.2.0) (the same as the first installation method above):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;wsrf&quot;</span>,
                 <span class="dt">configure.args=</span><span class="st">&quot;--enable-c11=no&quot;</span>)</code></pre></div>
<p>Finally the version using <em>Boost</em> for multithreading can be installed with the appropriate configuration options. This is suitable when the version of C++ available does not support C++11.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">install.packages</span>(<span class="st">&quot;wsrf&quot;</span>,
                 <span class="dt">type=</span><span class="st">&quot;source&quot;</span>,
                 <span class="dt">configure.args=</span><span class="st">&quot;--with-boost-include=&lt;Boost include path&gt;</span>
<span class="st">                                 --with-boost-lib=&lt;Boost lib path&gt;&quot;</span>)</code></pre></div>
</div>
<div id="usage" class="section level2">
<h2>Usage</h2>
<p>This section demonstrates how to use <strong>wsrf</strong>, especially on a cluster of machines.</p>
<p>The example uses a small dataset <em>weather</em> from <a href="http://cran.r-project.org/package=rattle"><strong>rattle</strong></a> <span class="citation">(G. J. Williams 2011)</span>. See the help page of <strong>rattle</strong> in R (<code>?weather</code>) for more details of <em>weather</em>. Below are the basic information of it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;rattle&quot;</span>)
ds &lt;-<span class="st"> </span>weather
<span class="kw">dim</span>(ds)</code></pre></div>
<pre><code>## [1] 366  24</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(ds)</code></pre></div>
<pre><code>##  [1] &quot;Date&quot;          &quot;Location&quot;      &quot;MinTemp&quot;       &quot;MaxTemp&quot;      
##  [5] &quot;Rainfall&quot;      &quot;Evaporation&quot;   &quot;Sunshine&quot;      &quot;WindGustDir&quot;  
##  [9] &quot;WindGustSpeed&quot; &quot;WindDir9am&quot;    &quot;WindDir3pm&quot;    &quot;WindSpeed9am&quot; 
## [13] &quot;WindSpeed3pm&quot;  &quot;Humidity9am&quot;   &quot;Humidity3pm&quot;   &quot;Pressure9am&quot;  
## [17] &quot;Pressure3pm&quot;   &quot;Cloud9am&quot;      &quot;Cloud3pm&quot;      &quot;Temp9am&quot;      
## [21] &quot;Temp3pm&quot;       &quot;RainToday&quot;     &quot;RISK_MM&quot;       &quot;RainTomorrow&quot;</code></pre>
<p>Before building the model we need to prepare the training dataset. First we note the various roles played by the different variables, including identifying the irrelevant variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">target &lt;-<span class="st"> &quot;RainTomorrow&quot;</span>
ignore &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Date&quot;</span>, <span class="st">&quot;Location&quot;</span>, <span class="st">&quot;RISK_MM&quot;</span>)
(vars &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">names</span>(ds), ignore))</code></pre></div>
<pre><code>##  [1] &quot;MinTemp&quot;       &quot;MaxTemp&quot;       &quot;Rainfall&quot;      &quot;Evaporation&quot;  
##  [5] &quot;Sunshine&quot;      &quot;WindGustDir&quot;   &quot;WindGustSpeed&quot; &quot;WindDir9am&quot;   
##  [9] &quot;WindDir3pm&quot;    &quot;WindSpeed9am&quot;  &quot;WindSpeed3pm&quot;  &quot;Humidity9am&quot;  
## [13] &quot;Humidity3pm&quot;   &quot;Pressure9am&quot;   &quot;Pressure3pm&quot;   &quot;Cloud9am&quot;     
## [17] &quot;Cloud3pm&quot;      &quot;Temp9am&quot;       &quot;Temp3pm&quot;       &quot;RainToday&quot;    
## [21] &quot;RainTomorrow&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dim</span>(ds[vars])</code></pre></div>
<pre><code>## [1] 366  21</code></pre>
<p>Next we deal with missing values, using <code>na.roughfix()</code> from <strong>randomForest</strong> to take care of them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;randomForest&quot;</span>)
if (<span class="kw">sum</span>(<span class="kw">is.na</span>(ds[vars]))) ds[vars] &lt;-<span class="st"> </span><span class="kw">na.roughfix</span>(ds[vars])
ds[target] &lt;-<span class="st"> </span><span class="kw">as.factor</span>(ds[[target]])
(tt &lt;-<span class="st"> </span><span class="kw">table</span>(ds[target]))</code></pre></div>
<pre><code>## 
##  No Yes 
## 300  66</code></pre>
<p>We construct the formula that describes the model which will predict the target based on all other variables.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(form &lt;-<span class="st"> </span><span class="kw">as.formula</span>(<span class="kw">paste</span>(target, <span class="st">&quot;~ .&quot;</span>)))</code></pre></div>
<pre><code>## RainTomorrow ~ .</code></pre>
<p>Finally we create the randomly selected training and test datasets, setting a seed so that the results can be exactly replicated.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">seed &lt;-<span class="st"> </span><span class="dv">42</span>
<span class="kw">set.seed</span>(seed)
<span class="kw">length</span>(train &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">nrow</span>(ds), <span class="fl">0.7</span>*<span class="kw">nrow</span>(ds)))</code></pre></div>
<pre><code>## [1] 256</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">length</span>(test &lt;-<span class="st"> </span><span class="kw">setdiff</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(ds)), train))</code></pre></div>
<pre><code>## [1] 110</code></pre>
<p>The signature of the function to build a weighted random forest model in <strong>wsrf</strong> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">wsrf</span>(formula, 
     data, 
     <span class="dt">ntrees=</span><span class="dv">500</span>, 
     <span class="dt">nvars=</span><span class="ot">NULL</span>,
     <span class="dt">weights=</span><span class="ot">TRUE</span>, 
     <span class="dt">parallel=</span><span class="ot">TRUE</span>)</code></pre></div>
<p>We use the training dataset to build a random forest model. All parameters, except <code>formula</code> and <code>data</code>, use their default values: <code>500</code> for <code>ntrees</code> — the number of trees; <code>TRUE</code> for <code>weights</code> — weighted subspace random forest or random forest; <code>TRUE</code> for <code>parallel</code> — use multi-thread or other options, etc.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;wsrf&quot;</span>)
model.wsrf<span class="fl">.1</span> &lt;-<span class="st"> </span><span class="kw">wsrf</span>(form, <span class="dt">data=</span>ds[train, vars])
<span class="kw">print</span>(model.wsrf<span class="fl">.1</span>)</code></pre></div>
<pre><code>## A Weighted Subspace Random Forest model with 500 trees.
## 
##   No. of variables tried at each split: 5
##                  Out-of-Bag Error Rate: 0.15
##                               Strength: 0.62
##                            Correlation: 0.19
## 
## Confusion matrix:
##      No Yes class.error
## No  209   6        0.03
## Yes  32   9        0.78</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(model.wsrf<span class="fl">.1</span>, <span class="dv">1</span>)  <span class="co"># Print tree 1.</span></code></pre></div>
<pre><code>## Tree 1 has 20 tests (internal nodes), with OOB error rate 0.1932:
## 
##  1) Pressure3pm &lt;= 1010.4
##  .. 2) MinTemp &lt;= 15
##  .. .. 3) MinTemp &lt;= 3.2   [Yes] (0 1) *
##  .. .. 3) MinTemp &gt;  3.2
##  .. .. .. 4) Cloud9am &lt;= 1   [No] (1 0) *
##  .. .. .. 4) Cloud9am &gt;  1
##  .. .. .. .. 5) WindSpeed3pm &lt;= 17
##  .. .. .. .. .. 6) WindGustSpeed &lt;= 35   [No] (1 0) *
##  .. .. .. .. .. 6) WindGustSpeed &gt;  35   [Yes] (0 1) *
##  .. .. .. .. 5) WindSpeed3pm &gt;  17   [No] (1 0) *
##  .. 2) MinTemp &gt;  15   [Yes] (0 1) *
##  1) Pressure3pm &gt;  1010.4
##  .. 7) Sunshine &lt;= 8.8
##  .. .. 8) Cloud3pm &lt;= 7
##  .. .. .. 9) Temp3pm &lt;= 14.6   [No] (1 0) *
##  .. .. .. 9) Temp3pm &gt;  14.6
##  .. .. .. .. 10) WindGustSpeed &lt;= 46
##  .. .. .. .. .. 11) Sunshine &lt;= 8.6
##  .. .. .. .. .. .. 12) Evaporation &lt;= 1.6
##  .. .. .. .. .. .. .. 13) Evaporation &lt;= 1.2   [No] (0.67 0.33) *
##  .. .. .. .. .. .. .. 13) Evaporation &gt;  1.2   [Yes] (0 1) *
##  .. .. .. .. .. .. 12) Evaporation &gt;  1.6
##  .. .. .. .. .. .. .. 14) Pressure3pm &lt;= 1015.8
##  .. .. .. .. .. .. .. .. 15) Pressure9am &lt;= 1018.1   [No] (1 0) *
##  .. .. .. .. .. .. .. .. 15) Pressure9am &gt;  1018.1   [Yes] (0 1) *
##  .. .. .. .. .. .. .. 14) Pressure3pm &gt;  1015.8   [No] (1 0) *
##  .. .. .. .. .. 11) Sunshine &gt;  8.6   [Yes] (0 1) *
##  .. .. .. .. 10) WindGustSpeed &gt;  46
##  .. .. .. .. .. 16) WindDir3pm == N   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == NNE   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == NE   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == ENE   [Yes] (0 1) *
##  .. .. .. .. .. 16) WindDir3pm == E   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == ESE   [No] (1 0) *
##  .. .. .. .. .. 16) WindDir3pm == SE   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == SSE   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == S   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == SSW   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == SW   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == WSW   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == W   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == WNW   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == NW   [Yes] (0.14 0.86) *
##  .. .. .. .. .. 16) WindDir3pm == NNW   [Yes] (0 1) *
##  .. .. 8) Cloud3pm &gt;  7
##  .. .. .. 17) Pressure9am &lt;= 1017.4   [No] (1 0) *
##  .. .. .. 17) Pressure9am &gt;  1017.4
##  .. .. .. .. 18) WindDir9am == N   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == NNE   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == NE   [Yes] (0 1) *
##  .. .. .. .. 18) WindDir9am == ENE   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == E   [Yes] (0 1) *
##  .. .. .. .. 18) WindDir9am == ESE   [Yes] (0 1) *
##  .. .. .. .. 18) WindDir9am == SE   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == SSE   [No] (1 0) *
##  .. .. .. .. 18) WindDir9am == S   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == SSW   [Yes] (0 1) *
##  .. .. .. .. 18) WindDir9am == SW   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == WSW   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == W   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == WNW   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == NW   [Yes] (0.1 0.9) *
##  .. .. .. .. 18) WindDir9am == NNW   [Yes] (0.1 0.9) *
##  .. 7) Sunshine &gt;  8.8
##  .. .. 19) Pressure3pm &lt;= 1011.7
##  .. .. .. 20) Humidity3pm &lt;= 30   [No] (1 0) *
##  .. .. .. 20) Humidity3pm &gt;  30   [Yes] (0 1) *
##  .. .. 19) Pressure3pm &gt;  1011.7   [No] (1 0) *</code></pre>
<p>Then, <code>predict</code> the classes of test data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cl &lt;-<span class="st"> </span><span class="kw">predict</span>(model.wsrf<span class="fl">.1</span>, <span class="dt">newdata=</span>ds[test, vars], <span class="dt">type=</span><span class="st">&quot;class&quot;</span>)
actual &lt;-<span class="st"> </span>ds[test, target]
(accuracy.wsrf &lt;-<span class="st"> </span><span class="kw">sum</span>(cl ==<span class="st"> </span>actual, <span class="dt">na.rm=</span><span class="ot">TRUE</span>)/<span class="kw">length</span>(actual))</code></pre></div>
<pre><code>## [1] 0.8363636</code></pre>
<p>Thus, we have built a model that is around 84% accurate on unseen testing data.</p>
<p>Using different random seed, we obtain another model.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Here we build another model without weighting.</span>
model.wsrf<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw">wsrf</span>(form, <span class="dt">data=</span>ds[train, vars], <span class="dt">weights=</span><span class="ot">FALSE</span>)
<span class="kw">print</span>(model.wsrf<span class="fl">.2</span>)</code></pre></div>
<pre><code>## A Weighted Subspace Random Forest model with 500 trees.
## 
##   No. of variables tried at each split: 5
##                  Out-of-Bag Error Rate: 0.15
##                               Strength: 0.59
##                            Correlation: 0.20
## 
## Confusion matrix:
##      No Yes class.error
## No  211   4        0.02
## Yes  35   6        0.85</code></pre>
<p>We can also derive a subset of the forest from the model or a combination of multiple forests.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">submodel.wsrf &lt;-<span class="st"> </span><span class="kw">subset.wsrf</span>(model.wsrf<span class="fl">.1</span>, <span class="dv">1</span>:<span class="dv">150</span>)
<span class="kw">print</span>(submodel.wsrf)</code></pre></div>
<pre><code>## A Weighted Subspace Random Forest model with 150 trees.
## 
##   No. of variables tried at each split: 5
##                  Out-of-Bag Error Rate: 0.14
##                               Strength: 0.61
##                            Correlation: 0.19
## 
## Confusion matrix:
##      No Yes class.error
## No  210   5        0.02
## Yes  32   9        0.78</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">bigmodel.wsrf &lt;-<span class="st"> </span><span class="kw">combine.wsrf</span>(model.wsrf<span class="fl">.1</span>, model.wsrf<span class="fl">.2</span>)
<span class="kw">print</span>(bigmodel.wsrf)</code></pre></div>
<pre><code>## A Weighted Subspace Random Forest model with 1000 trees.
## 
##   No. of variables tried at each split: 5
##                  Out-of-Bag Error Rate: 0.14
##                               Strength: 0.61
##                            Correlation: 0.19
## 
## Confusion matrix:
##      No Yes class.error
## No  211   4        0.02
## Yes  33   8        0.80</code></pre>
<p>Next, we will specify building the model on a cluster of servers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">servers &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;node&quot;</span>, <span class="dv">31</span>:<span class="dv">40</span>)
model.wsrf<span class="fl">.3</span> &lt;-<span class="st"> </span><span class="kw">wsrf</span>(form, <span class="dt">data=</span>ds[train, vars], <span class="dt">parallel=</span>servers)</code></pre></div>
<p>All we need is a character verctor specifying the hostnames of which nodes to use, or a named integer vector, whose values of the elements give how many threads to use for model building, in other words, how many trees built simultaneously. More detail descriptions about <strong>wsrf</strong> are presented in the <a href="http://cran.r-project.org/web/packages/wsrf/wsrf.pdf">manual</a>.</p>
<div class="references">
<h2 id="references" class="unnumbered">References</h2>
<div id="ref-dirk2013seamless">
<p>Eddelbuettel, Dirk. 2013. <em>Seamless R and C++ Integration with Rcpp</em>. New York: Springer.</p>
</div>
<div id="ref-dirk2011rcpp">
<p>Eddelbuettel, Dirk, and Romain François. 2011. “Rcpp: Seamless R and C++ Integration.” <em>Journal of Statistical Software</em> 40 (8): 1–18. <a href="http://www.jstatsoft.org/v40/i08/" class="uri">http://www.jstatsoft.org/v40/i08/</a>.</p>
</div>
<div id="ref-rattle">
<p>Williams, Graham J. 2011. <em>Data Mining with Rattle and R: The Art of Excavating Data for Knowledge Discovery</em>. Use R! Springer. <a href="http://www.amazon.com/gp/product/1441998896/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;tag=togaware-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399373&amp;creativeASIN=1441998896" class="uri">http://www.amazon.com/gp/product/1441998896/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;tag=togaware-20&amp;linkCode=as2&amp;camp=217145&amp;creative=399373&amp;creativeASIN=1441998896</a>.</p>
</div>
<div id="ref-xu2012classifying">
<p>Xu, Baoxun, Joshua Zhexue Huang, Graham Williams, Qiang Wang, and Yunming Ye. 2012. “Classifying Very High-Dimensional Data with Random Forests Built from Small Subspaces.” <em>International Journal of Data Warehousing and Mining (IJDWM)</em> 8 (2). IGI Global: 44–63.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>C++11 support is experimental in R-devel but not yet finished, see <a href="http://developer.r-project.org/blosxom.cgi/R-devel/NEWS/2013/12/02#n2013-12-02">Daily News about R-devel on 2013-12-02</a> and <a href="https://rawgit.com/kevinushey/RToolsToolchainUpdate/master/mingwnotes.html">MinGW-w64 Notes by Duncan Murdoch</a><a href="#fnref1">↩</a></p></li>
</ol>
</div>

<script type="text/javascript">
window.onload = function() {
  var i, fig = 1, caps = document.getElementsByClassName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.className !== 'figure' || cap.nodeName !== 'P')
      continue;
    cap.innerHTML = '<span>Figure ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
  fig = 1;
  caps = document.getElementsByTagName('caption');
  for (i = 0; i < caps.length; i++) {
    var cap = caps[i];
    if (cap.parentElement.nodeName !== 'TABLE') continue;
    cap.innerHTML = '<span>Table ' + fig + ':</span> ' + cap.innerHTML;
    fig++;
  }
}
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
